<!DOCTYPE HTML>
<html>

<head>
<meta charset="utf-8">
<style>
	body {
		height: 2000px;
	}
	.tooltip {
		border: 1px solid green;
		border-radius: 2px;
		background-color: white;
		padding: 10px 10px;
	}

	#house {
  margin-top: 50px;
  width: 400px;
    border: 1px solid brown;
  }

  #roof {
    width: 0;
    height: 0;
    border-left: 200px solid transparent;
    border-right: 200px solid transparent;
    border-bottom: 20px solid brown;
    margin-top: -20px;
  }

  p {
    text-align: justify;
    margin: 10px 3px;
  }
</style>
</head>

<body>

  <div data-tooltip="Это – внутренность дома" id="house">
    <div data-tooltip="Это – крыша" id="roof"></div>
    <p>Жили-были на свете три поросёнка. Три брата.</p>
    <p>Все одинакового роста, кругленькие, розовые, с одинаковыми весёлыми хвостиками.</p>
    <p>Даже имена у них были похожи. Звали поросят Ниф-Ниф, Нуф-Нуф и Наф-Наф. Всё лето они кувыркались в зелёной траве, грелись на солнышке, нежились в лужах.</p>
    <p>Но вот наступила осень. <a href="http://ru.wikipedia.org/wiki/Три_поросёнка" data-tooltip="Читать дальше&hellip;">Наведи на меня</a></p>
  </div>

<script>
	const tooltip = tooltipCreator();
  const lastElement = '';

	document.onmouseover = function (e) {
		const tooltipArg = e.target.getAttribute('data-tooltip');
		if (!tooltip.isShowing && tooltipArg) {
			const coordinates = e.target.getBoundingClientRect();
			tooltip.show(tooltipArg, coordinates, e.target);
		}
	};

	document.onmouseout = function (e) {
    const related = e.relatedTarget;
    const target = e.target;
    const outWindow = related === null;
    const outTooltip = tooltip.target && related === tooltip.target.parentNode;
    const hasTooltip = related && related.getAttribute('data-tooltip');
    const anotherTooltip = (related !== tooltip.target) && hasTooltip;

    if (outWindow || outTooltip || anotherTooltip) {
      tooltip.hide();
    }
	}

	function tooltipCreator () {
    let isShowing = false;
    let target = '';
		const tooltipMargin = 6;
		const tooltipElement = document.createElement('div');
    
		tooltipElement.className = 'tooltip';
		tooltipElement.style.position = 'absolute';
		tooltipElement.style.display = 'none';

		document.body.insertBefore(tooltipElement, null);

		return {
      get isShowing () {
        return isShowing;
      },

      get target () {
        return target;
      },

			show: (htmlContent, coordinates = {}, currentTarget) => {
				let {
				 	top = 0,
				 	left = 0,
				 	right = 0,
					bottom = 0,
					width = 0	
				} = coordinates;
				const pageScrollTop = pageYOffset;

        isShowing = true;
        target = currentTarget;

				tooltipElement.innerHTML = htmlContent;
				tooltipElement.style.display = 'block';

				tooltipHeight = tooltipElement.offsetHeight + tooltipMargin;
				tooltipWidth = tooltipElement.offsetWidth;
				
				let elemMiddle = left + (width / 2);
				let tooltipMiddle = tooltipWidth / 2;
				let middleCoord = elemMiddle - tooltipMiddle;

				top = (top - tooltipHeight > 0) 
					? (top - tooltipHeight + pageScrollTop) + 'px'
					: (bottom + tooltipMargin + pageScrollTop) + 'px';
				left = middleCoord > 0 ? middleCoord + 'px' : 0;

				tooltipElement.style.top = top;
				tooltipElement.style.left = left;
			},

			hide: () => {
        isShowing = false;
        target = null;
				tooltipElement.style.display = 'none';
				tooltipElement.innerHTML = '';
			}	
		};
	}
</script>

</body>

</html>
