<!DOCTYPE HTML>
<html>

<head>
<meta charset="utf-8">
<style>
	body {
		height: 2000px;
	}
	.tooltip {
		border: 1px solid green;
		border-radius: 2px;
		background-color: white;
		padding: 10px 10px;
	}
</style>
</head>

<body>

<p>ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя</p>
<p>ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя ЛяЛяЛя</p>

<button data-tooltip="подсказка длиннее, чем элемент">Короткая кнопка</button>
<button data-tooltip="HTML<br>подсказка">Ещё кнопка</button>

<p>Прокрутите страницу, чтобы ссылки были вверху и проверьте, правильно ли показываются подсказки.</p>


<script>
	const tooltip = tooltipCreator();

	document.onmouseover = function (e) {
		const tooltipArg = e.target.getAttribute('data-tooltip');
		if (tooltipArg) {
			const coordinates = e.target.getBoundingClientRect();
			tooltip.show(tooltipArg, coordinates);
		}
	};

	document.onmouseout = function (e) {
		tooltip.hide();
	}

	function tooltipCreator () {
		const tooltipMargin = 6;
		const tooltipElement = document.createElement('div');
		tooltipElement.className = 'tooltip';
		tooltipElement.style.position = 'absolute';
		tooltipElement.style.display = 'none';

		document.body.insertBefore(tooltipElement, null);

		return {
			show: (htmlContent, coordinates = {}) => {
				let {
				 	top = 0,
				 	left = 0,
				 	right = 0,
					bottom = 0,
					width = 0	
				} = coordinates;
				const pageScrollTop = pageYOffset;

				tooltipElement.innerHTML = htmlContent;
				tooltipElement.style.display = 'block';

				tooltipHeight = tooltipElement.offsetHeight + tooltipMargin;
				tooltipWidth = tooltipElement.offsetWidth;
				
				let elemMiddle = left + (width / 2);
				let tooltipMiddle = tooltipWidth / 2;
				let middleCoord = elemMiddle - tooltipMiddle;

				top = (top - tooltipHeight > 0) 
					? (top - tooltipHeight + pageScrollTop) + 'px'
					: (bottom + tooltipMargin + pageScrollTop) + 'px';
				left = middleCoord > 0 ? middleCoord + 'px' : 0;

				tooltipElement.style.top = top;
				tooltipElement.style.left = left;
			},

			hide: () => {
				tooltipElement.style.display = 'none';
				tooltipElement.innerHTML = '';
			}	
		};
	}
</script>

</body>

</html>
